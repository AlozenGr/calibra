<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calibração – Estação Total</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 text-slate-800">
  <div class="max-w-6xl mx-auto p-4 md:p-8 space-y-6">

    <!-- Cabeçalho -->
    <header class="flex items-center justify-between gap-3">
      <div>
        <h1 class="text-2xl font-bold">Calibração – Estação Total</h1>
        <p class="text-sm text-slate-500">
          EDM + Ângulos (HZ/V) • Conferência (ANTES) e Após (DEPOIS)
        </p>
      </div>
      <div class="text-right">
        <div class="text-xs text-slate-500">status</div>
        <div class="text-sm font-semibold" id="status">offline</div>
      </div>
    </header>

    <!-- Config API -->
    <section class="bg-white rounded-2xl shadow p-4">
      <h2 class="font-semibold mb-2">Configuração da API</h2>
      <div class="grid grid-cols-1 md:grid-cols-6 gap-2 text-sm">
        <input id="apiBase" class="border rounded p-2 md:col-span-5"
               value="COLE_AQUI_SUA_URL_DO_WEBAPP_EXEC" />
        <button class="border rounded p-2 bg-slate-100" onclick="saveApi()">Salvar</button>
      </div>
      <div class="mt-2 text-xs text-slate-500">
        Dica: depois de salvar, o sistema usa essa URL para gravar na planilha.
      </div>
    </section>

    <!-- 1) Nova calibração -->
    <section class="bg-white rounded-2xl shadow p-4">
      <h2 class="font-semibold mb-3">1) Nova calibração</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
        <input id="calibId" class="border rounded p-2" placeholder="ID (ex: CAL-2026-001)" />
        <input id="data" type="date" class="border rounded p-2" />
        <input id="cliente" class="border rounded p-2 col-span-2" placeholder="Cliente / Razão Social" />
        <input id="cnpj" class="border rounded p-2" placeholder="CNPJ / CPF" />
        <input id="instrumento" class="border rounded p-2" placeholder="Instrumento" />
        <input id="fabricante" class="border rounded p-2" placeholder="Fabricante" />
        <input id="modelo" class="border rounded p-2" placeholder="Modelo" />
        <input id="ns" class="border rounded p-2" placeholder="Nº Série" />
        <input id="res" class="border rounded p-2" placeholder='Resolução angular (")' />
        <input id="obs" class="border rounded p-2 col-span-2" placeholder="Observações" />
      </div>
      <div class="mt-3 flex gap-2 flex-wrap">
        <button class="px-3 py-2 rounded bg-blue-600 text-white" onclick="novaCalibracao()">Salvar calibração</button>
        <button class="px-3 py-2 rounded bg-slate-200" onclick="fillDemo()">Exemplo</button>
      </div>
    </section>

    <!-- 2) EDM -->
    <section class="bg-white rounded-2xl shadow p-4">
      <h2 class="font-semibold mb-2">2) Leituras EDM</h2>

      <div class="grid grid-cols-2 md:grid-cols-8 gap-2 text-sm">
        <input id="edm_calibId" class="border rounded p-2 md:col-span-2" placeholder="calibId" />
        <input id="edm_alvo" class="border rounded p-2 md:col-span-2" placeholder="Alvo / Base" />
        <input id="edm_aferida" class="border rounded p-2" placeholder="Leitura aferida (m)" />
        <input id="edm_lida" class="border rounded p-2" placeholder="Leitura lida (m)" />

        <select id="edm_face" class="border rounded p-2">
          <option value="Direta">Direta</option>
          <option value="Invertida">Invertida</option>
        </select>

        <input id="edm_rep" class="border rounded p-2" placeholder="Repetição" />
        <input id="edm_t" class="border rounded p-2" placeholder="Temp (°C)" />
        <input id="edm_ur" class="border rounded p-2" placeholder="Umidade (%)" />
        <input id="edm_p" class="border rounded p-2" placeholder="Pressão (hPa)" />
      </div>

      <div class="mt-3 flex gap-2 items-center">
        <label class="flex items-center gap-2 text-sm">
          <input id="edm_usar" type="checkbox" checked /> usar
        </label>
        <button class="px-3 py-2 rounded bg-emerald-600 text-white" onclick="addEdm()">Adicionar EDM</button>
        <button class="px-3 py-2 rounded bg-slate-200" onclick="fillDemoEdm()">Exemplo EDM</button>
      </div>
    </section>

    <!-- 3) Angulares (Conferência) -->
    <section class="bg-white rounded-2xl shadow p-4">
      <div class="flex items-start justify-between gap-4 flex-wrap">
        <div>
          <h2 class="font-semibold">3) Leituras Angulares (HZ / V) — <span class="text-slate-600">Conferência</span></h2>
          <p class="text-xs text-slate-500">Digite Direta (F1) e Invertida (F2). O “Resultado” é calculado automaticamente.</p>
        </div>
        <div class="text-xs text-slate-500">
          Aceita: <b>0°00'23"</b> ou <b>0 0 23</b> ou <b>0.006388</b> (grau decimal)
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-6 gap-2 text-sm mt-3">
        <input id="ang_calibId" class="border rounded p-2 md:col-span-2" placeholder="calibId" />
        <input id="ang_obs" class="border rounded p-2 md:col-span-4" placeholder="Observações (opcional)" />
      </div>

      <!-- HZ -->
      <div class="mt-4 border rounded-xl p-3 bg-slate-50">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <div class="font-semibold">Horizontal (HZ)</div>
          <div class="text-xs text-slate-500">Resultado HZ = |(F1 + F2) − 180°|</div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-8 gap-2 text-sm mt-2">
          <input id="hz_pos" class="border rounded p-2 md:col-span-2" placeholder="Posição (0°/180° ou 90°/270°)" />
          <input id="hz_f1" class="border rounded p-2 md:col-span-3" placeholder='Leitura direta (F1)' oninput="previewHzResult()" />
          <input id="hz_f2" class="border rounded p-2 md:col-span-3" placeholder='Leitura invertida (F2)' oninput="previewHzResult()" />
        </div>

        <div class="mt-2 flex items-center gap-3 flex-wrap">
          <label class="flex items-center gap-2 text-sm">
            <input id="hz_usar" type="checkbox" checked /> usar
          </label>

          <button class="px-3 py-2 rounded bg-emerald-600 text-white" onclick="addAngHZ()">
            Adicionar HZ
          </button>

          <div class="ml-auto text-sm">
            <span class="text-slate-500 mr-2">Resultado:</span>
            <span id="hz_result" class="font-bold text-blue-700">0°00'00"</span>
            <span id="hz_result_sec" class="text-xs text-slate-500 ml-2">(0")</span>
          </div>
        </div>

        <!-- Lista visível -->
        <div class="mt-3">
          <div class="text-xs font-semibold text-slate-600 mb-2">Leituras HZ adicionadas</div>
          <div id="hz_list" class="space-y-2"></div>
        </div>
      </div>

      <!-- V -->
      <div class="mt-4 border rounded-xl p-3 bg-slate-50">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <div class="font-semibold">Vertical (V)</div>
          <div class="text-xs text-slate-500">Resultado V = |F1 − (180° − F2)|</div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-8 gap-2 text-sm mt-2">
          <input id="v_pos" class="border rounded p-2 md:col-span-2" placeholder="Posição vertical" />
          <input id="v_f1" class="border rounded p-2 md:col-span-3" placeholder='Leitura direta (F1)' oninput="previewVResult()" />
          <input id="v_f2" class="border rounded p-2 md:col-span-3" placeholder='Leitura invertida (F2)' oninput="previewVResult()" />
        </div>

        <div class="mt-2 flex items-center gap-3 flex-wrap">
          <label class="flex items-center gap-2 text-sm">
            <input id="v_usar" type="checkbox" checked /> usar
          </label>

          <button class="px-3 py-2 rounded bg-emerald-600 text-white" onclick="addAngV()">
            Adicionar V
          </button>

          <div class="ml-auto text-sm">
            <span class="text-slate-500 mr-2">Resultado:</span>
            <span id="v_result" class="font-bold text-blue-700">0°00'00"</span>
            <span id="v_result_sec" class="text-xs text-slate-500 ml-2">(0")</span>
          </div>
        </div>

        <!-- Lista visível -->
        <div class="mt-3">
          <div class="text-xs font-semibold text-slate-600 mb-2">Leituras V adicionadas</div>
          <div id="v_list" class="space-y-2"></div>
        </div>
      </div>

      <!-- FECHAMENTO / RESULTADO FINAL -->
      <div class="mt-4 border-2 border-slate-900 rounded-xl p-3 bg-white">
        <div class="font-semibold text-center text-lg">Resultado (fechamento)</div>
        <div class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
          <div class="p-3 rounded-lg border bg-slate-50 flex items-center justify-between">
            <div class="text-slate-600">HZ (última leitura)</div>
            <div>
              <span id="final_hz" class="font-extrabold text-blue-700 text-lg">0°00'00"</span>
              <span id="final_hz_sec" class="text-xs text-slate-500 ml-2">(0")</span>
            </div>
          </div>
          <div class="p-3 rounded-lg border bg-slate-50 flex items-center justify-between">
            <div class="text-slate-600">V (última leitura)</div>
            <div>
              <span id="final_v" class="font-extrabold text-blue-700 text-lg">0°00'00"</span>
              <span id="final_v_sec" class="text-xs text-slate-500 ml-2">(0")</span>
            </div>
          </div>
        </div>
        <div class="mt-2 text-xs text-slate-500 text-center">
          Regra de cor: <span class="text-blue-700 font-semibold">AZUL</span> = 0°00'00" •
          <span class="text-red-700 font-semibold">VERMELHO</span> = diferente de zero
        </div>
      </div>

    </section>

    <!-- 4) Processamento -->
    <section class="bg-white rounded-2xl shadow p-4">
      <h2 class="font-semibold mb-2">4) Processar</h2>
      <div class="grid grid-cols-1 md:grid-cols-6 gap-2 text-sm">
        <input id="run_calibId" class="border rounded p-2 md:col-span-2" placeholder="calibId" />
        <button class="px-3 py-2 rounded bg-indigo-600 text-white" onclick="calcular('ANTES')">
          Calcular ANTES
        </button>
        <button class="px-3 py-2 rounded bg-purple-600 text-white" onclick="calcular('DEPOIS')">
          Calcular DEPOIS
        </button>
        <button class="px-3 py-2 rounded bg-slate-800 text-white" onclick="relatorio()">
          Gerar Certificado
        </button>
      </div>

      <pre id="out" class="text-xs mt-3 bg-slate-100 p-3 rounded"></pre>
    </section>

  </div>

<script>
/** ===========================
 *  Config / API
 *  =========================== */
let API_BASE = localStorage.getItem('CALIBRA_API_BASE') || '';

function saveApi(){
  API_BASE = document.getElementById('apiBase').value.trim();
  localStorage.setItem('CALIBRA_API_BASE', API_BASE);
  ping();
}
async function ping(){
  try{
    const r = await fetch(API_BASE+'?ping=1');
    document.getElementById('status').innerText = r.ok ? 'online' : 'offline';
  }catch(e){
    document.getElementById('status').innerText = 'offline';
  }
}
function val(id){ return document.getElementById(id).value.trim(); }
function out(v){ document.getElementById('out').textContent = JSON.stringify(v,null,2); }

async function callAPI(action,payload){
  const body = new URLSearchParams({data:JSON.stringify({action,payload})});
  const r = await fetch(API_BASE,{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body});
  return r.json();
}

/** ===========================
 *  Conversões ângulo
 *  =========================== */

// Converte string (DMS ou "d m s" ou decimal) em grau decimal
function dmsToDecimal(input){
  const s = (input || '').trim();
  if (!s) return NaN;

  // já é número?
  if (/^[+-]?\d+(\.\d+)?$/.test(s)) return Number(s);

  // Normaliza
  const cleaned = s
    .replace(/[^\d\.\-\+°'"\s]/g, ' ')
    .replace(/\s+/g, ' ')
    .trim();

  // "deg° min' sec""
  const re1 = /^([+-])?\s*(\d+(?:\.\d+)?)\s*°\s*(\d+(?:\.\d+)?)?\s*'?\s*(\d+(?:\.\d+)?)?\s*"?$/;
  const m1 = cleaned.match(re1);
  if (m1) {
    const sign = m1[1] === '-' ? -1 : 1;
    const deg = Number(m1[2] || 0);
    const min = Number(m1[3] || 0);
    const sec = Number(m1[4] || 0);
    return sign * (Math.abs(deg) + (min/60) + (sec/3600));
  }

  // "deg min sec"
  const parts = cleaned.split(' ').filter(Boolean);
  if (parts.length >= 1 && parts.length <= 3 && parts.every(p => /^[+-]?\d+(\.\d+)?$/.test(p))) {
    const deg = Number(parts[0] || 0);
    const min = Number(parts[1] || 0);
    const sec = Number(parts[2] || 0);
    const sign = deg < 0 ? -1 : 1;
    return sign * (Math.abs(deg) + (min/60) + (sec/3600));
  }

  return NaN;
}

// Normaliza ângulo em graus para o intervalo [0, 360)
function norm360(deg){
  let x = deg % 360;
  if (x < 0) x += 360;
  return x;
}

// Converte segundos (") para DMS string
function secToDMS(sec){
  const sign = sec < 0 ? '-' : '';
  sec = Math.abs(sec);

  const deg = Math.floor(sec / 3600);
  const rem1 = sec - deg*3600;
  const min = Math.floor(rem1 / 60);
  const s = Math.round(rem1 - min*60);

  // Ajuste de carry
  let D = deg, M = min, S = s;
  if (S >= 60){ S -= 60; M += 1; }
  if (M >= 60){ M -= 60; D += 1; }

  return `${sign}${D}°${String(M).padStart(2,'0')}'${String(S).padStart(2,'0')}"`;
}

// Aplica cor (azul se 0, vermelho se != 0)
function colorize(el, sec){
  el.classList.remove('text-blue-700','text-red-700');
  if (Math.abs(sec) > 0) el.classList.add('text-red-700');
  else el.classList.add('text-blue-700');
}

/** ===========================
 *  Cálculos de resultado (conferência)
 *  =========================== */

// Resultado HZ = |(F1 + F2) - 180°|
function computeHzErrorSeconds(F1deg, F2deg){
  if (Number.isNaN(F1deg) || Number.isNaN(F2deg)) return null;

  const f1 = norm360(F1deg);
  const f2 = norm360(F2deg);

  // erro em graus:
  let errDeg = (f1 + f2) - 180.0;

  // traga para o intervalo [-180, +180] para evitar coisas como 359°
  errDeg = ((errDeg + 180) % 360) - 180;

  const errSec = Math.round(Math.abs(errDeg) * 3600);
  return errSec;
}

// Resultado V = |F1 - (180° - F2)|
function computeVErrorSeconds(F1deg, F2deg){
  if (Number.isNaN(F1deg) || Number.isNaN(F2deg)) return null;

  const f1 = norm360(F1deg);
  const f2 = norm360(F2deg);

  // (180 - F2)
  let ref = 180.0 - f2;
  ref = norm360(ref);

  // diferença em graus
  let errDeg = f1 - ref;

  // traga para [-180, +180]
  errDeg = ((errDeg + 180) % 360) - 180;

  const errSec = Math.round(Math.abs(errDeg) * 3600);
  return errSec;
}

function previewHzResult(){
  const f1 = dmsToDecimal(val('hz_f1'));
  const f2 = dmsToDecimal(val('hz_f2'));
  const sec = computeHzErrorSeconds(f1, f2);

  const el = document.getElementById('hz_result');
  const el2 = document.getElementById('hz_result_sec');

  if (sec === null){
    el.textContent = `0°00'00"`;
    el2.textContent = `(0")`;
    el.classList.remove('text-red-700'); el.classList.add('text-blue-700');
    return;
  }

  el.textContent = secToDMS(sec);
  el2.textContent = `(${sec}")`;
  colorize(el, sec);

  // também atualiza o fechamento (preview)
  document.getElementById('final_hz').textContent = secToDMS(sec);
  document.getElementById('final_hz_sec').textContent = `(${sec}")`;
  colorize(document.getElementById('final_hz'), sec);
}

function previewVResult(){
  const f1 = dmsToDecimal(val('v_f1'));
  const f2 = dmsToDecimal(val('v_f2'));
  const sec = computeVErrorSeconds(f1, f2);

  const el = document.getElementById('v_result');
  const el2 = document.getElementById('v_result_sec');

  if (sec === null){
    el.textContent = `0°00'00"`;
    el2.textContent = `(0")`;
    el.classList.remove('text-red-700'); el.classList.add('text-blue-700');
    return;
  }

  el.textContent = secToDMS(sec);
  el2.textContent = `(${sec}")`;
  colorize(el, sec);

  // também atualiza o fechamento (preview)
  document.getElementById('final_v').textContent = secToDMS(sec);
  document.getElementById('final_v_sec').textContent = `(${sec}")`;
  colorize(document.getElementById('final_v'), sec);
}

/** ===========================
 *  Ações: salvar calibração / EDM
 *  =========================== */

async function novaCalibracao(){
  const r = await callAPI('newCalibration',{
    calibId:val('calibId'),data:val('data'),cliente:val('cliente'),cnpj:val('cnpj'),
    instrumento:val('instrumento'),fabricante:val('fabricante'),
    modelo:val('modelo'),ns:val('ns'),res_ang_arcsec:val('res'),obs:val('obs')
  });
  out(r);
}

async function addEdm(){
  const r = await callAPI('addEdmRows',[{
    calibId:val('edm_calibId'),
    ponto:val('edm_alvo'),
    dist_nom_m:val('edm_aferida'),
    dist_lida_m:val('edm_lida'),
    face:val('edm_face'),
    rep:val('edm_rep'),
    temp_C:val('edm_t'),
    UR_percent:val('edm_ur'),
    press_hPa:val('edm_p'),
    usar:document.getElementById('edm_usar').checked
  }]);
  out(r);
}

/** ===========================
 *  Ações: adicionar HZ / V (mantém visível + envia API)
 *  =========================== */

function addRowToList(listId, rowHtml){
  const list = document.getElementById(listId);
  const div = document.createElement('div');
  div.innerHTML = rowHtml;
  list.prepend(div.firstElementChild);
}

async function addAngHZ(){
  const calibId = val('ang_calibId');
  const pos = val('hz_pos');
  const f1s = val('hz_f1');
  const f2s = val('hz_f2');

  const f1 = dmsToDecimal(f1s);
  const f2 = dmsToDecimal(f2s);

  if (!calibId) return out({ok:false,error:'Informe calibId em Leituras Angulares.'});
  if (Number.isNaN(f1) || Number.isNaN(f2)) return out({ok:false,error:'HZ: F1/F2 inválidos.'});

  const sec = computeHzErrorSeconds(f1,f2);
  const dms = secToDMS(sec);

  // Mantém visível na tela (lista)
  const color = (sec===0) ? 'text-blue-700' : 'text-red-700';
  addRowToList('hz_list', `
    <div class="bg-white border rounded-lg p-2 text-sm flex items-center justify-between gap-3">
      <div class="min-w-0">
        <div class="font-semibold">Posição: ${escapeHtml(pos || '-')}</div>
        <div class="text-xs text-slate-500">F1: ${escapeHtml(f1s)} • F2: ${escapeHtml(f2s)}</div>
      </div>
      <div class="text-right">
        <div class="text-xs text-slate-500">Resultado</div>
        <div class="font-bold ${color}">${dms} <span class="text-xs text-slate-500">(${sec}")</span></div>
      </div>
    </div>
  `);

  // Atualiza fechamento (com a última leitura adicionada)
  document.getElementById('final_hz').textContent = dms;
  document.getElementById('final_hz_sec').textContent = `(${sec}")`;
  colorize(document.getElementById('final_hz'), sec);

  // Envia para planilha (compatível com backend atual)
  const r = await callAPI('addAngleRows',{
    tipo:'HZ',
    rows:[{
      calibId,
      conjunto: pos,     // posicao
      F1_deg: f1,
      F2_deg: f2,
      obs: val('ang_obs'),
      usar: document.getElementById('hz_usar').checked
    }]
  });
  out(r);
}

async function addAngV(){
  const calibId = val('ang_calibId');
  const pos = val('v_pos');
  const f1s = val('v_f1');
  const f2s = val('v_f2');

  const f1 = dmsToDecimal(f1s);
  const f2 = dmsToDecimal(f2s);

  if (!calibId) return out({ok:false,error:'Informe calibId em Leituras Angulares.'});
  if (Number.isNaN(f1) || Number.isNaN(f2)) return out({ok:false,error:'V: F1/F2 inválidos.'});

  const sec = computeVErrorSeconds(f1,f2);
  const dms = secToDMS(sec);

  // Mantém visível na tela (lista)
  const color = (sec===0) ? 'text-blue-700' : 'text-red-700';
  addRowToList('v_list', `
    <div class="bg-white border rounded-lg p-2 text-sm flex items-center justify-between gap-3">
      <div class="min-w-0">
        <div class="font-semibold">Posição: ${escapeHtml(pos || '-')}</div>
        <div class="text-xs text-slate-500">F1: ${escapeHtml(f1s)} • F2: ${escapeHtml(f2s)}</div>
      </div>
      <div class="text-right">
        <div class="text-xs text-slate-500">Resultado</div>
        <div class="font-bold ${color}">${dms} <span class="text-xs text-slate-500">(${sec}")</span></div>
      </div>
    </div>
  `);

  // Atualiza fechamento (última leitura adicionada)
  document.getElementById('final_v').textContent = dms;
  document.getElementById('final_v_sec').textContent = `(${sec}")`;
  colorize(document.getElementById('final_v'), sec);

  // Envia para planilha
  const r = await callAPI('addAngleRows',{
    tipo:'V',
    rows:[{
      calibId,
      conjunto: pos,     // posicao
      F1_deg: f1,
      F2_deg: f2,
      obs: val('ang_obs'),
      usar: document.getElementById('v_usar').checked
    }]
  });
  out(r);
}

// escape simples p/ HTML
function escapeHtml(str){
  return String(str||'')
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'","&#039;");
}

/** ===========================
 *  Processamento / Certificado
 *  =========================== */
async function calcular(fase){
  const r = await callAPI('computeAll',{calibId:val('run_calibId'),fase});
  out(r);
}
async function relatorio(){
  const r = await callAPI('generateReport',{calibId:val('run_calibId')});
  out(r);
}

/** ===========================
 *  Demos
 *  =========================== */
function fillDemo(){
  document.getElementById('calibId').value = 'CAL-TEST-001';
  document.getElementById('data').valueAsDate = new Date();
  document.getElementById('cliente').value = 'Cliente Exemplo LTDA';
  document.getElementById('cnpj').value = '12.345.678/0001-90';
  document.getElementById('instrumento').value = 'Estação Total';
  document.getElementById('fabricante').value = 'Topgeo';
  document.getElementById('modelo').value = 'TG-5200';
  document.getElementById('ns').value = '885231';
  document.getElementById('res').value = '5';
  document.getElementById('obs').value = 'Exemplo fictício para teste.';

  document.getElementById('edm_calibId').value = 'CAL-TEST-001';
  document.getElementById('ang_calibId').value = 'CAL-TEST-001';
  document.getElementById('run_calibId').value = 'CAL-TEST-001';

  // exemplo HZ (teu caso)
  document.getElementById('hz_pos').value = '0°/180°';
  document.getElementById('hz_f1').value = `0°00'00"`;
  document.getElementById('hz_f2').value = `179°59'52"`;
  previewHzResult();

  // exemplo V
  document.getElementById('v_pos').value = 'Vertical';
  document.getElementById('v_f1').value = `89°59'52"`;
  document.getElementById('v_f2').value = `270°00'08"`;
  previewVResult();

  out({ok:true, msg:'Exemplo preenchido.'});
}

function fillDemoEdm(){
  document.getElementById('edm_alvo').value = 'Base 30 m';
  document.getElementById('edm_aferida').value = '30.000';
  document.getElementById('edm_lida').value = '30.003';
  document.getElementById('edm_face').value = 'Direta';
  document.getElementById('edm_rep').value = '1';
  document.getElementById('edm_t').value = '23.5';
  document.getElementById('edm_ur').value = '60';
  document.getElementById('edm_p').value = '1013';
  out({ok:true, msg:'Exemplo EDM preenchido.'});
}

// init
if (API_BASE) document.getElementById('apiBase').value = API_BASE;
ping();
</script>
</body>
</html>
